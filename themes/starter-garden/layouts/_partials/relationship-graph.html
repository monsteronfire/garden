{{ $graphData := dict "nodes" (slice) "links" (slice) }}
{{ $nodes := slice }}
{{ $links := slice }}

{{/* Collect all posts with relationships */}}
{{ range .Site.RegularPages }}
  {{ if .Params.relationships }}
    {{ $node := dict 
      "id" .File.BaseFileName
      "title" .Title
      "growth_stage" (index .Params.growth 0 | default "seed")
      "type" (.Params.type | default "note")
      "url" .RelPermalink
    }}
    {{ $nodes = $nodes | append $node }}
    
    {{/* Create links for each relationship type */}}
    {{ range $relType, $targets := .Params.relationships }}
      {{ range $targets }}
        {{ $link := dict
          "source" $.File.BaseFileName
          "target" .
          "type" $relType
        }}
        {{ $links = $links | append $link }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

<div class="relationship-graph" data-nodes="{{ $nodes | jsonify }}" data-links="{{ $links | jsonify }}">
  <svg id="garden-graph"></svg>
  <div class="tooltip"></div>
  Relationship Garden Path Graph
</div>

{{/* Load relationship-graph JavaScript file */}}
{{- $graph := resources.Get "js/relationship-graph.js" }}
{{- if $graph }}
  {{- if hugo.IsDevelopment }}
    <script src="{{ $graph.RelPermalink }}"></script>
  {{- else }}
    {{- with $graph | minify | fingerprint }}
      <script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous"></script>
    {{- end }}
  {{- end }}
{{- end }}
